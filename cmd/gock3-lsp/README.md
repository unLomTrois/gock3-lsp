The current implementation is based on [nomad-lsp](https://github.com/juliosueiras/nomad-lsp/blob/master/main.go#L127)

Then I asked openai o1 to refactor it in 2 shots